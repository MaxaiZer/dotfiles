steps:
  - id: install-amneziavpn-arch
    os: "%arch"
    packages: ["amneziavpn-bin"]
    package_source: aur

  - id: amneziavpn-fix-arch #https://github.com/amnezia-vpn/amnezia-client/issues/792#issuecomment-2508097498
    os: "%arch"
    script: |
      sudo systemctl enable --now systemd-resolved.service
      sudo ln -sf ../run/systemd/resolve/stub-resolv.conf /etc/resolv.conf

  - id: install-pipewire-effects
    os: "linux"
    packages: ["easyeffects", "lsp-plugins"]
    script: |
      sudo find /usr/share/applications -maxdepth 1 -type f -name 'in.lsp_plug*.desktop' -delete && sudo update-desktop-database

  - id: install-snapper
    os: "linux"
    packages: ["snapper", "snap-pac", "btrfs-assistant"]
    script: sudo snapper -c root create-config /

  - id: install-cron-arch
    os: "%arch"
    packages: ["cronie"]
    script: sudo systemctl enable --now cronie.service

  - id: install-anki-non-arch
    os: "!%arch"
    packages: ["anki"]

  - id: install-anki-arch
    os: "%arch"
    packages: ["anki-bin"]
    package_source: aur

  - id: install-obsidian
    packages: ["obsidian"]

  - id: install-messaging-apps
    packages: ["telegram-desktop", "discord"]

  - id: install-browser
    packages: ["vivaldi"]

  - id: install-torrent
    packages: ["qbittorrent"]

  - id: install-qdirstat-arch
    os: "%arch"
    packages: ["qdirstat"]
    package_source: aur

  - id: install-printer-support
    os: "linux"
    packages: ["system-config-printer", "cups"]

  - id: install-brother-printer-driver-arch
    os: "%arch"
    packages: ["brlaser"]
    package_source: aur

  - id: install-multimedia-helpers-arch
    os: "%arch"
    packages: ["subtitleedit"]
    package_source: aur

  - id: activate-davinci-20.2-linux #download from https://www.blackmagicdesign.com/support/download/4593ec0ea9cf4e9899668c0601166220/Linux
    os: "linux"
    script: |
      set -e
      cd /opt/resolve
      rm libs/libglib-2.0.so* && rm libs/libgio-2.0.so* && rm libs/libgmodule-2.0.so*
      sudo perl -pi -e 's/\x03\x00\x89\x45\xFC\x83\x7D\xFC\x00\x74\x11\x48\x8B\x45\xC8\x8B/\x03\x00\x89\x45\xFC\x83\x7D\xFC\x00\xEB\x11\x48\x8B\x45\xC8\x8B/' bin/resolve
      sudo perl -pi -e 's/\x74\x11\x48\x8B\x45\xC8\x8B\x55\xFC\x89\x50\x58\xB8\x00\x00\x00/\xEB\x11\x48\x8B\x45\xC8\x8B\x55\xFC\x89\x50\x58\xB8\x00\x00\x00/' bin/resolve
      sudo perl -pi -e 's/\x41\xb6\x01\x84\xc0\x0f\x84\xb0\x00\x00\x00\x48\x85\xdb\x74\x08\x45\x31\xf6\xe9\xa3\x00\x00\x00/\x41\xb6\x00\x84\xc0\x0f\x84\xb0\x00\x00\x00\x48\x85\xdb\x74\x08\x45\x31\xf6\xe9\xa3\x00\x00\x00/' bin/resolve
      echo -e "LICENSE blackmagic davinciresolvestudio 999999 permanent uncounted\n  hostid=ANY issuer=CGP customer=CGP issued=28-dec-2023\n  akey=0000-0000-0000-0000 _ck=00 sig=\"00\"" | sudo tee .license/blackmagic.lic
